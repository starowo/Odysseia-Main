# 轮换通知功能说明

## 功能概述

轮换通知模块允许管理员通过 Discord 的 Scheduled Events 功能实现自动轮换的服务器通知。系统会按照设定的时间间隔自动更新服务器 Event，展示不同的通知内容。

## 功能特性

- ✅ 自动创建和管理 Discord Scheduled Events
- ✅ 支持添加、删除、编辑轮换通知条目
- ✅ 自定义轮换间隔时间
- ✅ 支持封面图片
- ✅ 自动轮换到下一个条目
- ✅ 数据持久化存储

## 命令说明

所有命令都需要管理员权限。

### `/轮换通知 添加`

添加一个新的轮换通知条目。

**参数：**
- `id` (必需): 条目的唯一标识符
- `标题` (必需): 通知的标题
- `描述` (必需): 通知的详细描述
- `位置` (必需): 活动位置（可以是实体地址或虚拟位置）
- `封面图` (可选): 封面图片附件

**示例：**
```
/轮换通知 添加
  id: event001
  标题: 每周创作活动
  描述: 欢迎参加本周的创作活动！
  位置: 创作频道
  封面图: [上传图片]
```

### `/轮换通知 删除`

删除一个已存在的轮换通知条目。

**参数：**
- `id` (必需): 要删除的条目ID

**示例：**
```
/轮换通知 删除 id: event001
```

### `/轮换通知 编辑`

编辑一个已存在的轮换通知条目。

**参数：**
- `id` (必需): 要编辑的条目ID
- `标题` (必需): 新的标题
- `描述` (必需): 新的描述
- `位置` (必需): 新的位置
- `封面图` (可选): 新的封面图片

**示例：**
```
/轮换通知 编辑
  id: event001
  标题: 更新后的标题
  描述: 更新后的描述
  位置: 新的位置
```

### `/轮换通知 列表`

查看所有轮换通知条目及配置信息。

**示例：**
```
/轮换通知 列表
```

显示内容包括：
- 所有条目的详细信息
- 当前切换频率
- 当前显示的条目索引

### `/轮换通知 切换频率`

设置轮换通知的切换间隔时间。

**参数：**
- `间隔时间` (必需): 切换间隔（秒），最小值为 60 秒

**常用时间换算：**
- 30分钟 = 1800秒
- 1小时 = 3600秒
- 2小时 = 7200秒
- 6小时 = 21600秒
- 12小时 = 43200秒
- 1天 = 86400秒

**示例：**
```
/轮换通知 切换频率 间隔时间: 3600
```

## 工作原理

1. **自动创建 Event**：当添加第一个轮换通知条目时，系统会自动创建一个 Discord Scheduled Event。

2. **定时轮换**：后台任务每分钟检查一次，当当前 Event 即将开始（小于5分钟）时，自动更新为下一个条目。

3. **循环播放**：所有条目会按照添加顺序循环播放，播放到最后一个后会回到第一个。

4. **自动管理**：
   - 添加条目时自动创建或更新 Event
   - 删除条目时自动更新 Event
   - 删除所有条目时自动删除 Event
   - 编辑条目时自动更新当前显示的 Event

## 使用场景

- 📢 定期活动通知
- 🎨 创作比赛轮播
- 📅 活动日程提醒
- 🎉 社区公告轮换
- 🎯 重要信息展示

## 配置说明

在 `config.json` 中启用模块：

```json
{
  "cogs": {
    "banner": {
      "enabled": true,
      "description": "轮换通知功能"
    }
  }
}
```

## 数据存储

轮换通知数据存储在 `data/banner/` 目录下，每个服务器一个 JSON 文件。

文件命名格式：`{guild_id}.json`

## 注意事项

1. **权限要求**：机器人需要有 "Manage Events" 权限才能创建和管理 Scheduled Events。

2. **条目ID**：每个条目的 ID 必须唯一，建议使用有意义的标识符。

3. **最小间隔**：切换间隔不能少于 60 秒，以避免过于频繁的更新。

4. **封面图片**：封面图片必须通过附件上传，系统会自动保存图片 URL。

5. **自动同步**：系统会自动处理 Event 的创建、更新和删除，无需手动管理。

6. **Event类型**：创建的是外部事件（External Event），因此 "位置" 参数会显示在 Event 详情中。

## 常见问题

**Q: 为什么添加条目后 Event 没有立即显示？**  
A: Event 会在添加后约 10 秒开始显示，这是为了给系统预留准备时间。

**Q: 可以暂停轮换吗？**  
A: 可以通过删除所有条目来停止轮换，或者将切换频率设置得非常大（如 86400 秒 = 1 天）。

**Q: 如果手动删除了 Discord 上的 Event 会怎样？**  
A: 系统会在下次检查时发现 Event 不存在，并自动创建一个新的。

**Q: 可以为不同服务器设置不同的轮换通知吗？**  
A: 可以，每个服务器的配置是独立的。

## 技术实现

- **数据持久化**：使用 JSON 文件存储配置
- **定时任务**：使用 `discord.ext.tasks` 实现后台轮换
- **Event管理**：使用 Discord API 的 Scheduled Events 功能
- **图片处理**：通过 aiohttp 获取图片数据并上传到 Event

## 更新日志

### v1.0.0 (2025-10-18)
- ✨ 初始版本发布
- ✨ 实现基本的添加、删除、编辑、列表功能
- ✨ 实现自动轮换机制
- ✨ 支持自定义切换频率
- ✨ 支持封面图片

